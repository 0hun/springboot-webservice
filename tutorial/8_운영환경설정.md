# 8. 운영 환경 설정

저번시간까지 배포 환경에 대한 설정을 진행했습니다!  
이제는 서비스 중단 없이 배포가 가능한 상태가 되었는데요.  
이대로 서비스 하면 될까요?  
뭔가 하나 놓친게 있지 않으신가요?  
현재는 **스프링부트에서 실제 운영 DB의 설정을 갖고 있지 않습니다**.  
즉, 아직은 프로젝트가 AWS RDS와 연동된 상태가 아닙니다.  
그래서 이번 시간엔 스프링부트와 운영 DB 접근 등의 실제 운영환경 설정을 진행하겠습니다.  


## 8-1. 운영 DB 접근

저번 시간에 저희는 운영 YAML (```real-application.yml```)만 별도로 분리해 EC2 서버에 추가했습니다.  
간단하게 생각하면 운영 DB 접속 정보는 ```real-application.yml```에 추가하면 됩니다.  
하지만 이렇게 될 경우 **set1, set2 설정에 같은 내용을 반복 추가**해야되고, **변경이 있을 경우 2개 profile 코드를 모두 고쳐**야 합니다.  
추가로 운영 레디스 접근 혹은 외부 운영 API 등의 접속정보도 **항상 set1과 set2에 복사 & 붙여넣기**를 반복해야합니다.  
그래서! 이부분을 좀 더 개선해보겠습니다.  

### 8-1-1. 운영 DB 드라이버 의존성 추가

제일 먼저 할일은 운영 DB의 드라이버를 추가하는 것입니다.  
build.gradle에 아래와 같이 Maria DB 드라이버를 추가합니다.

```groovy
compile("org.mariadb.jdbc:mariadb-java-client")
```

### 8-1-2. YAML(.yml) 수정

이번 시간에 사용할 기능은 스프링부트의 [Adding active profiles](https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-adding-active-profiles) 입니다.  
yml에서 특정 Profile을 **포함**시켜 설정을 공유하는 개념정도로 보시면 됩니다.  
  
자 우선 프로젝트 내부의 application.yml을 조금 수정해보겠습니다.  
기존에 real-application.yml에 있던 set1, set2 내용을 그대로 복사해서 붙여넣습니다.

```yml
spring:
  profiles:
    active: local # 기본 환경 선택

# local 환경
---
spring:
  profiles: local
  datasource:
    data: classpath:data-h2.sql # 시작할때 실행시킬 script
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: create-drop
  h2:
    console:
      enabled: true

# 운영 환경
---
spring:
  profiles: set1
server:
  port: 8081

---
spring:
  profiles: set2

server:
  port: 8082
```

real-application.yml

```yml
---
spring:
  profiles: realdb
  datasource:
        url: jdbc:mariadb://rds주소:포트명(기본은 3306)/database명
        username: db계정명
        password: db계정 비밀번호
        driver-class-name: org.mariadb.jdbc.Driver
```

### 8-1-3. 운영 DB에 테이블 생성